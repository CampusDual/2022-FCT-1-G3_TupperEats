<?xml version="1.0" encoding="UTF-8"?>
<JdbcEntitySetup
        xmlns="http://www.ontimize.com/schema/jdbc"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.ontimize.com/schema/jdbc http://www.ontimize.com/schema/jdbc/ontimize-jdbc-dao.xsd"
        catalog="" schema="${mainschema}" table="suscription_customer"
        datasource="mainDataSource" sqlhandler="dbSQLStatementHandler">
    <DeleteKeys>
        <Column>suscription_customer_id</Column>
    </DeleteKeys>
    <UpdateKeys>
        <Column>suscription_customer_id</Column>
    </UpdateKeys>
    <Queries>
		<Query id="default">
			<Sentence>
			   <![CDATA[
			     SELECT
			      #COLUMNS#
			     FROM
			      suscription_customer sc JOIN customer c 
			      	ON sc.id_customer = c.customer_id
					JOIN suscription s 
					ON sc.id_suscription =s.suscription_id 
				 #WHERE#
			   ]]>
			</Sentence>
		</Query>
		
		<Query id="graficaSuscription">
			<Sentence>
			   <![CDATA[
			     SELECT 
			      count(id_suscription) as cuenta, id_suscription 
				 FROM 
				  suscription_customer 
				 GROUP BY
				  id_suscription 
				 #WHERE#
			   ]]>
			</Sentence>
		</Query>
		
		<Query id="endDateSuscription">
			<Sentence>
			   <![CDATA[
			     SELECT
			      #COLUMNS#
			     FROM
			      suscription_customer sc JOIN customer c 
			      	ON sc.id_customer = c.customer_id
					JOIN suscription s 
					ON sc.id_suscription =s.suscription_id 
				  WHERE
				  current_date <= end_date_suscription_customer
			   ]]>
			</Sentence>
		</Query>
		
		<Query id="suscriptionMenuQuery">
		<AmbiguousColumns>
                <AmbiguousColumn name="first_plate" prefix="pp"
                    databaseName="product_id" />
                <AmbiguousColumn name="second_plate" prefix="ps"
                    databaseName="product_id" />
                <AmbiguousColumn name="dessert" prefix="po"
                    databaseName="product_id" />
                <AmbiguousColumn name="first_plate_name" prefix="pp"
                    databaseName="name" />
                <AmbiguousColumn name="second_plate_name" prefix="ps"
                    databaseName="name" />
                <AmbiguousColumn name="dessert_name" prefix="po"
                    databaseName="name" />
                <AmbiguousColumn name="id_customer_suscription" prefix="sc"
                    databaseName="id_customer" />
                <AmbiguousColumn name="id_customer_menu" prefix="mc"
                    databaseName="id_customer" />
            </AmbiguousColumns>
			<Sentence>
			   <![CDATA[
			     SELECT
			      #COLUMNS#
			     FROM
			   	 suscription_customer sc
				JOIN menu_customer mc ON sc.suscription_customer_id = mc.id_suscription_customer
				JOIN menu m ON mc.id_menu = m.menu_id
				JOIN product pp ON m.first_plate = pp.product_id
				JOIN product ps ON m.second_plate = ps.product_id
				JOIN product po ON m.dessert = po.product_id
				#WHERE#
			   ]]>
			</Sentence>
		</Query>
	</Queries>
</JdbcEntitySetup>